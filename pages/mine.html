<!DOCTYPE html><html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RSC  Mining Platform - </title>
    
    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    
    <!-- Styles -->
    <link rel="stylesheet" href="../styles/global.css">
    <link rel="stylesheet" href="../styles/quantum-mining.css">
    
    <!-- Favicon -->
    <link rel="icon" type="image/x-icon" href="../assets/img/logo.png">
    
    <!-- Meta tags -->
    <meta name="description" content="RSC Quantum Mining Platform - El sistema de minería más avanzado del mundo">
    <meta name="keywords" content="RSC, mining, quantum, blockchain, cryptocurrency">
    <meta name="author" content="RSC Chain">
    
    <!-- Open Graph -->
    <meta property="og:title" content="RSC Quantum Mining Platform">
    <meta property="og:description" content="El sistema de minería más avanzado del mundo">
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://rscchain.com/mine">
    <meta property="og:image" content="../assets/img/hero-mining.png">
</head>
<body>
    <!-- Quantum Background -->
    <div class="quantum-background">
        <div class="quantum-particles"></div>
        <div class="quantum-waves"></div>
        <div class="quantum-grid"></div>
    </div>
    
    <!-- Header -->
    <header class="quantum-header">
        <div class="header-container">
            <div class="logo-section">
                <div class="logo-container">
                    <div class="quantum-logo">
                        <div class="logo-core">
                            <div class="logo-quantum">
                                <div class="quantum-ring ring-1"></div>
                                <div class="quantum-ring ring-2"></div>
                                <div class="quantum-ring ring-3"></div>
                                <div class="quantum-center">
                                    <span class="logo-text">RSC</span>
                                    <div class="quantum-pulse"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="logo-info">
                        <h1 class="platform-title">
                            <span class="title-main">QUANTUM</span>
                            <span class="title-sub">MINING PLATFORM</span>
                        </h1>
                        <p class="platform-description">
                            <i class="fas fa-atom"></i>
                            Sistema de minería cuántica de última generación
                        </p>
                        <div class="platform-badges">
                            <span class="badge badge-quantum">Quantum Core</span>
                            <span class="badge badge-neural">Neural Network</span>
                            <span class="badge badge-hybrid">Hybrid Fusion</span>
                            <span class="badge badge-adaptive">Adaptive Matrix</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="header-controls">
                <div class="connection-status">
                    <div class="status-indicator" id="connectionStatus">
                        <div class="status-dot"></div>
                        <div class="status-pulse"></div>
                    </div>
                    <div class="status-info">
                        <span class="status-label">Connection</span>
                        <span class="status-value" id="connectionText">Connecting...</span>
                    </div>
                </div>
                
                <div class="user-info" id="userInfo" style="display: none;">
                    <div class="user-avatar">
                        <i class="fas fa-user-circle"></i>
                    </div>
                    <div class="user-details">
                        <span class="user-name" id="userName">Miner</span>
                        <span class="user-balance" id="userBalance">0.000000 RSC</span>
                    </div>
                </div>
                
                <div class="header-actions">
                    <button class="btn-header" id="settingsBtn">
                        <i class="fas fa-cog"></i>
                        <span>Settings</span>
                    </button>
                    <button class="btn-header" id="helpBtn">
                        <i class="fas fa-question-circle"></i>
                        <span>Help</span>
                    </button>
                    <button class="btn-header" id="logoutBtn" style="display: none;">
                        <i class="fas fa-sign-out-alt"></i>
                        <span>Logout</span>
                    </button>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="quantum-main">
        <div class="container">
            <!-- Authentication Section -->
            <section class="auth-section" id="authSection">
                <div class="auth-container">
                    <div class="auth-card">
                        <div class="auth-header">
                            <div class="auth-logo">
                                <div class="quantum-logo">
                                    <div class="logo-core">
                                        <div class="logo-quantum">
                                            <div class="quantum-ring ring-1"></div>
                                            <div class="quantum-ring ring-2"></div>
                                            <div class="quantum-ring ring-3"></div>
                                            <div class="quantum-center">
                                                <span class="logo-text">RSC</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <h2 class="auth-title">Welcome to Quantum Mining</h2>
                            <p class="auth-subtitle">Sign in to access the most advanced mining platform</p>
                        </div>
                        
                        <div class="auth-forms">
                            <!-- Login Form -->
                            <form class="auth-form active" id="loginForm">
                                <div class="form-group">
                                    <label for="loginEmail">Email Address</label>
                                    <div class="input-container">
                                        <i class="fas fa-envelope"></i>
                                        <input type="email" id="loginEmail" placeholder="Enter your email" required>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label for="loginPassword">Password</label>
                                    <div class="input-container">
                                        <i class="fas fa-lock"></i>
                                        <input type="password" id="loginPassword" placeholder="Enter your password" required>
                                    </div>
                                </div>
                                <button type="submit" class="btn-quantum btn-full">
                                    <i class="fas fa-sign-in-alt"></i>
                                    <span>Sign In</span>
                                    <div class="btn-glow"></div>
                                </button>
                                <div class="form-footer">
                                    <p>Don't have an account? <a href="#" id="showRegister">Sign up</a></p>
                                </div>
                            </form>
                            
                            <!-- Register Form -->
                            <form class="auth-form" id="registerForm">
                                <div class="form-group">
                                    <label for="registerEmail">Email Address</label>
                                    <div class="input-container">
                                        <i class="fas fa-envelope"></i>
                                        <input type="email" id="registerEmail" placeholder="Enter your email" required>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label for="registerUsername">Username</label>
                                    <div class="input-container">
                                        <i class="fas fa-user"></i>
                                        <input type="text" id="registerUsername" placeholder="Choose a username" required>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label for="registerPassword">Password</label>
                                    <div class="input-container">
                                        <i class="fas fa-lock"></i>
                                        <input type="password" id="registerPassword" placeholder="Create a password" required>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label for="referralCode">Referral Code (Optional)</label>
                                    <div class="input-container">
                                        <i class="fas fa-gift"></i>
                                        <input type="text" id="referralCode" placeholder="Enter referral code">
                                    </div>
                                </div>
                                <button type="submit" class="btn-quantum btn-full">
                                    <i class="fas fa-user-plus"></i>
                                    <span>Sign Up</span>
                                    <div class="btn-glow"></div>
                                </button>
                                <div class="form-footer">
                                    <p>Already have an account? <a href="#" id="showLogin">Sign in</a></p>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
            </section>
            
            <!-- Quantum Mining Dashboard -->
            <section class="mining-dashboard" id="miningDashboard" style="display: none;">
                <!-- User Stats -->
                <div class="user-stats">
                    <div class="stat-card">
                        <div class="stat-icon">
                            <i class="fas fa-wallet"></i>
                        </div>
                        <div class="stat-content">
                            <h4>Balance</h4>
                            <p class="stat-value" id="userBalanceDisplay">0.000000 RSC</p>
                        </div>
                    </div>
                    
                    <div class="stat-card">
                        <div class="stat-icon">
                            <i class="fas fa-coins"></i>
                        </div>
                        <div class="stat-content">
                            <h4>Total Mined</h4>
                            <p class="stat-value" id="totalMinedDisplay">0.000000 RSC</p>
                        </div>
                    </div>
                    
                    <div class="stat-card">
                        <div class="stat-icon">
                            <i class="fas fa-bolt"></i>
                        </div>
                        <div class="stat-content">
                            <h4>Mining Power</h4>
                            <p class="stat-value" id="miningPowerDisplay">1.00x</p>
                        </div>
                    </div>
                    
                    <div class="stat-card">
                        <div class="stat-icon">
                            <i class="fas fa-trophy"></i>
                        </div>
                        <div class="stat-content">
                            <h4>Level</h4>
                            <p class="stat-value" id="miningLevelDisplay">1</p>
                        </div>
                    </div>
                </div>

                <!-- Algorithm Selection -->
                <div class="algorithm-section">
                    <h3 class="section-title">
                        <i class="fas fa-atom"></i>
                        Select Mining Algorithm
                    </h3>
                    <div class="algorithm-grid" id="algorithmGrid">
                        <div class="algorithm-card active" data-algorithm="quantum-core">
                            <div class="algorithm-icon">
                                <i class="fas fa-atom"></i>
                            </div>
                            <h4>Quantum Core</h4>
                            <p>Highest efficiency, moderate power consumption</p>
                            <div class="algorithm-stats">
                                <span class="stat">Efficiency: 95%</span>
                                <span class="stat">Power: 2.5kW</span>
                            </div>
                        </div>
                        
                        <div class="algorithm-card" data-algorithm="neural-network">
                            <div class="algorithm-icon">
                                <i class="fas fa-brain"></i>
                            </div>
                            <h4>Neural Network</h4>
                            <p>Adaptive learning, low power consumption</p>
                            <div class="algorithm-stats">
                                <span class="stat">Efficiency: 88%</span>
                                <span class="stat">Power: 1.8kW</span>
                            </div>
                        </div>
                        
                        <div class="algorithm-card" data-algorithm="hybrid-fusion">
                            <div class="algorithm-icon">
                                <i class="fas fa-bolt"></i>
                            </div>
                            <h4>Hybrid Fusion</h4>
                            <p>Best of both worlds, high power consumption</p>
                            <div class="algorithm-stats">
                                <span class="stat">Efficiency: 92%</span>
                                <span class="stat">Power: 3.2kW</span>
                            </div>
                        </div>
                        
                        <div class="algorithm-card" data-algorithm="adaptive-matrix">
                            <div class="algorithm-icon">
                                <i class="fas fa-cogs"></i>
                            </div>
                            <h4>Adaptive Matrix</h4>
                            <p>Self-optimizing, highest power consumption</p>
                            <div class="algorithm-stats">
                                <span class="stat">Efficiency: 98%</span>
                                <span class="stat">Power: 4.1kW</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Mining Control Panel -->
                <div class="mining-control-panel">
                    <div class="control-header">
                        <h3 class="control-title">
                            <i class="fas fa-play-circle"></i>
                            Mining Control
                        </h3>
                        <div class="mining-status" id="miningStatus">
                            <div class="status-indicator">
                                <div class="status-dot offline"></div>
                                <div class="status-pulse"></div>
                            </div>
                            <span class="status-text">Ready to Start</span>
                        </div>
                    </div>
                    
                    <div class="control-actions">
                        <button class="btn-quantum btn-large" id="startMiningBtn">
                            <i class="fas fa-play"></i>
                            <span>Start Quantum Mining</span>
                            <div class="btn-glow"></div>
                        </button>
                        <button class="btn-danger btn-large hidden" id="stopMiningBtn">
                            <i class="fas fa-stop"></i>
                            <span>Stop Mining</span>
                            <div class="btn-glow"></div>
                        </button>
                        <button class="btn-secondary btn-large hidden" id="pauseMiningBtn">
                            <i class="fas fa-pause"></i>
                            <span>Pause</span>
                            <div class="btn-glow"></div>
                        </button>
                    </div>
                </div>

                <!-- Real-time Metrics -->
                <div class="metrics-section">
                    <h3 class="section-title">
                        <i class="fas fa-chart-line"></i>
                        Real-time Metrics
                    </h3>
                    <div class="metrics-grid">
                        <div class="metric-card">
                            <div class="metric-icon">
                                <i class="fas fa-tachometer-alt"></i>
                            </div>
                            <div class="metric-content">
                                <h4>Hash Rate</h4>
                                <p class="metric-value" id="hashRateDisplay">0 H/s</p>
                                <div class="metric-progress">
                                    <div class="progress-bar" id="hashRateProgress"></div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="metric-card">
                            <div class="metric-icon">
                                <i class="fas fa-coins"></i>
                            </div>
                            <div class="metric-content">
                                <h4>Tokens/Second</h4>
                                <p class="metric-value" id="tokensPerSecondDisplay">0.000000 RSC/s</p>
                                <div class="metric-progress">
                                    <div class="progress-bar" id="tokensProgress"></div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="metric-card">
                            <div class="metric-icon">
                                <i class="fas fa-percentage"></i>
                            </div>
                            <div class="metric-content">
                                <h4>Efficiency</h4>
                                <p class="metric-value" id="efficiencyDisplay">100%</p>
                                <div class="metric-progress">
                                    <div class="progress-bar" id="efficiencyProgress"></div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="metric-card">
                            <div class="metric-icon">
                                <i class="fas fa-battery-half"></i>
                            </div>
                            <div class="metric-content">
                                <h4>Energy</h4>
                                <p class="metric-value" id="energyDisplay">0.00 kWh</p>
                                <div class="metric-progress">
                                    <div class="progress-bar" id="energyProgress"></div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="metric-card">
                            <div class="metric-icon">
                                <i class="fas fa-thermometer-half"></i>
                            </div>
                            <div class="metric-content">
                                <h4>Temperature</h4>
                                <p class="metric-value" id="temperatureDisplay">20°C</p>
                                <div class="metric-progress">
                                    <div class="progress-bar" id="temperatureProgress"></div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="metric-card">
                            <div class="metric-icon">
                                <i class="fas fa-shield-alt"></i>
                            </div>
                            <div class="metric-content">
                                <h4>Stability</h4>
                                <p class="metric-value" id="stabilityDisplay">100%</p>
                                <div class="metric-progress">
                                    <div class="progress-bar" id="stabilityProgress"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Mining Progress -->
                <div class="progress-section">
                    <h3 class="section-title">
                        <i class="fas fa-chart-pie"></i>
                        Mining Progress
                    </h3>
                    <div class="progress-container">
                        <div class="progress-header">
                            <span class="progress-label">Session Progress</span>
                            <span class="progress-percentage" id="progressPercentage">0%</span>
                        </div>
                        <div class="progress-bar-container">
                            <div class="progress-bar-fill" id="progressBarFill"></div>
                            <div class="progress-particles" id="progressParticles"></div>
                        </div>
                        <div class="progress-info">
                            <div class="progress-item">
                                <span class="progress-label">Session Time</span>
                                <span class="progress-value" id="sessionTimeDisplay">00:00:00</span>
                            </div>
                            <div class="progress-item">
                                <span class="progress-label">Tokens Mined</span>
                                <span class="progress-value" id="sessionTokensDisplay">0.000000 RSC</span>
                            </div>
                            <div class="progress-item">
                                <span class="progress-label">Total Hashes</span>
                                <span class="progress-value" id="totalHashesDisplay">0</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Equipment Section -->
                <div class="equipment-section">
                    <h3 class="section-title">
                        <i class="fas fa-tools"></i>
                        Mining Equipment
                    </h3>
                    <div class="equipment-grid" id="equipmentGrid">
                        <div class="equipment-card">
                            <div class="equipment-icon">
                                <i class="fas fa-microchip"></i>
                            </div>
                            <h4>Quantum Processor</h4>
                            <p>Advanced quantum computing unit</p>
                            <div class="equipment-level">
                                <span>Level 1</span>
                                <div class="level-bar">
                                    <div class="level-fill" style="width: 25%"></div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="equipment-card">
                            <div class="equipment-icon">
                                <i class="fas fa-memory"></i>
                            </div>
                            <h4>Neural Memory</h4>
                            <p>High-speed memory for mining data</p>
                            <div class="equipment-level">
                                <span>Level 1</span>
                                <div class="level-bar">
                                    <div class="level-fill" style="width: 15%"></div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="equipment-card">
                            <div class="equipment-icon">
                                <i class="fas fa-fan"></i>
                            </div>
                            <h4>Cooling System</h4>
                            <p>Advanced thermal management</p>
                            <div class="equipment-level">
                                <span>Level 1</span>
                                <div class="level-bar">
                                    <div class="level-fill" style="width: 30%"></div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="equipment-card">
                            <div class="equipment-icon">
                                <i class="fas fa-bolt"></i>
                            </div>
                            <h4>Power Core</h4>
                            <p>Efficient energy management system</p>
                            <div class="equipment-level">
                                <span>Level 1</span>
                                <div class="level-bar">
                                    <div class="level-fill" style="width: 20%"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Leaderboard -->
                <div class="leaderboard-section">
                    <h3 class="section-title">
                        <i class="fas fa-trophy"></i>
                        Top Miners
                    </h3>
                    <div class="leaderboard-container">
                        <div class="leaderboard-header">
                            <div class="leaderboard-tabs">
                                <button class="tab-btn active" data-period="all">All Time</button>
                                <button class="tab-btn" data-period="day">Today</button>
                                <button class="tab-btn" data-period="week">This Week</button>
                                <button class="tab-btn" data-period="month">This Month</button>
                            </div>
                        </div>
                        <div class="leaderboard-list" id="leaderboardList">
                            <div class="leaderboard-item">
                                <div class="rank">1</div>
                                <div class="miner-info">
                                    <div class="miner-name">QuantumMiner</div>
                                    <div class="miner-stats">1,234.567 RSC</div>
                        </div>
                                <div class="miner-status online">Online</div>
                            </div>
                            
                            <div class="leaderboard-item">
                                <div class="rank">2</div>
                                <div class="miner-info">
                                    <div class="miner-name">NeuralNet</div>
                                    <div class="miner-stats">987.654 RSC</div>
                                </div>
                                <div class="miner-status online">Online</div>
                            </div>
                            
                            <div class="leaderboard-item">
                                <div class="rank">3</div>
                                <div class="miner-info">
                                    <div class="miner-name">HybridFusion</div>
                                    <div class="miner-stats">876.543 RSC</div>
                                </div>
                                <div class="miner-status offline">Offline</div>
                            </div>
                            
                            <div class="leaderboard-item">
                                <div class="rank">4</div>
                                <div class="miner-info">
                                    <div class="miner-name">AdaptiveMatrix</div>
                                    <div class="miner-stats">765.432 RSC</div>
                                </div>
                                <div class="miner-status online">Online</div>
                            </div>
                            
                            <div class="leaderboard-item">
                                <div class="rank">5</div>
                                <div class="miner-info">
                                    <div class="miner-name">CryptoMiner</div>
                                    <div class="miner-stats">654.321 RSC</div>
                                </div>
                                <div class="miner-status online">Online</div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>
        </div>
    </main>

    <!-- Modals -->
    <div class="modal" id="settingsModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Settings</h2>
                <button class="modal-close" id="closeSettingsModal">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <div class="settings-section">
                    <h4>Mining Settings</h4>
                    <div class="setting-item">
                        <label for="autoSync">Auto Sync</label>
                        <input type="checkbox" id="autoSync" checked>
                    </div>
                    <div class="setting-item">
                        <label for="notifications">Notifications</label>
                        <input type="checkbox" id="notifications" checked>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="modal" id="helpModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Help & Support</h2>
                <button class="modal-close" id="closeHelpModal">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <div class="help-section">
                    <h4>🚀 Getting Started</h4>
                    <ol>
                        <li>Select your preferred mining algorithm</li>
                        <li>Click "Start Quantum Mining" to begin</li>
                        <li>Monitor real-time metrics and progress</li>
                        <li>Your tokens are automatically saved</li>
                    </ol>
                </div>
                
                <div class="help-section">
                    <h4>⛏️ Mining Features</h4>
                    <ul>
                        <li><strong>Quantum Core:</strong> Highest efficiency, moderate power consumption</li>
                        <li><strong>Neural Network:</strong> Adaptive learning, low power consumption</li>
                        <li><strong>Hybrid Fusion:</strong> Best of both worlds, high power consumption</li>
                        <li><strong>Adaptive Matrix:</strong> Self-optimizing, highest power consumption</li>
                    </ul>
                </div>
                
                <div class="help-section">
                    <h4>💡 Tips</h4>
                    <ul>
                        <li>Keep your browser open for best performance</li>
                        <li>Higher mining power = more tokens</li>
                        <li>Equipment upgrades boost efficiency</li>
                        <li>Refer friends to earn commissions</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>

    <!-- Notifications -->
    <div class="notifications-container" id="notificationsContainer"></div>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/dist/main.min.js"></script>
    <script src="../scripts/supabase-integration.js"></script>
    <script>
        // Inicializar cuando esté listo
        document.addEventListener('DOMContentLoaded', function() {
            console.log('🚀 RSC Mining Platform cargando...');
            
            // Esperar a que Supabase Integration se cargue
            let attempts = 0;
            const maxAttempts = 50;
            
            const checkSupabase = () => {
                attempts++;
                console.log(`🔍 Intento ${attempts}/${maxAttempts} - Verificando Supabase Integration...`);
                
                if (window.supabaseIntegration) {
                    console.log('✅ Supabase Integration detectado');
                    initializeMiningPlatform();
                } else if (attempts >= maxAttempts) {
                    console.error('❌ Timeout: Supabase Integration no se cargó en 5 segundos');
                } else {
                    setTimeout(checkSupabase, 100);
                }
            };
            
            checkSupabase();
        });

        function initializeMiningPlatform() {
            console.log('🚀 Inicializando RSC Mining Platform...');
            
            // Configurar event listeners para el sistema existente
            setupAuthEventListeners();
            setupMiningEventListeners();
            
            // Verificar si el usuario ya está autenticado
            if (window.supabaseIntegration.isUserAuthenticated()) {
                showMiningDashboard();
                
                // Esperar un poco para que se cargue la sesión
                setTimeout(async () => {
                    await checkAndRestoreMiningSession();
                }, 1000);
            } else {
                showAuthSection();
            }
            
            console.log('✅ RSC Mining Platform - LISTO');
        }

        async function checkAndRestoreMiningSession() {
            try {
                console.log('🔍 Verificando sesión de minería...');
                
                // Verificar si hay una sesión de minería activa usando la función de supabaseIntegration
                const hasActiveSession = await window.supabaseIntegration.checkMiningSession();
                
                if (hasActiveSession) {
                    console.log('⛏️ Sesión de minería activa detectada - Reanudando...');
                    console.log(`⏰ Tiempo restante: ${window.supabaseIntegration.getRemainingTime()} horas`);
                    
                    // Sincronizar balance del usuario con la sesión
                    syncUserBalance();
                    
                    // Ocultar botón de inicio y mostrar que está minando
                    document.getElementById('startMiningBtn').style.display = 'none';
                    document.getElementById('stopMiningBtn').classList.add('hidden');
                    
                    // Reanudar simulación de minería
                    startMiningSimulation();
                    
                    // Mostrar estado actual de la sesión
                    showSessionStatus();
                    
                    // Mostrar notificación
                    showNotification('⛏️ Minería reanudada - Sesión de 24 horas activa', 'success');
                } else {
                    console.log('ℹ️ No hay sesión de minería activa');
                }
            } catch (error) {
                console.error('❌ Error verificando sesión de minería:', error);
            }
        }

        function syncUserBalance() {
            try {
                const user = window.supabaseIntegration.getCurrentUser();
                const session = window.supabaseIntegration.getMiningSession();
                
                if (user && session.isActive) {
                    console.log('🔄 Sincronizando balance del usuario...');
                    console.log(`💰 Balance actual: ${user.balance.toFixed(6)} RSC`);
                    console.log(`⛏️ Tokens en sesión: ${session.tokensMined.toFixed(6)} RSC`);
                    
                    // Actualizar la interfaz para mostrar el balance correcto
                    updateBalanceDisplay();
                    
                    console.log('✅ Balance sincronizado correctamente');
                }
            } catch (error) {
                console.error('❌ Error sincronizando balance:', error);
            }
        }

        function updateBalanceDisplay() {
            const user = window.supabaseIntegration.getCurrentUser();
            if (user) {
                // Actualizar balance en el header
                const userBalance = document.getElementById('userBalance');
                const userBalanceDisplay = document.getElementById('userBalanceDisplay');
                const totalMinedDisplay = document.getElementById('totalMinedDisplay');
                
                if (userBalance) {
                    userBalance.textContent = user.balance.toFixed(6) + ' RSC';
                }
                if (userBalanceDisplay) {
                    userBalanceDisplay.textContent = user.balance.toFixed(6) + ' RSC';
                }
                if (totalMinedDisplay) {
                    totalMinedDisplay.textContent = user.balance.toFixed(6) + ' RSC';
                }
                
                console.log(`💰 Balance actualizado en UI: ${user.balance.toFixed(6)} RSC`);
            }
        }

        function setupAuthEventListeners() {
            // Login form
            const loginForm = document.getElementById('loginForm');
            if (loginForm) {
                loginForm.addEventListener('submit', async (e) => {
                    e.preventDefault();
                    await handleLogin();
                });
            }

            // Register form
            const registerForm = document.getElementById('registerForm');
            if (registerForm) {
                registerForm.addEventListener('submit', async (e) => {
                    e.preventDefault();
                    await handleRegister();
                });
            }

            // Tab switching
            const showRegister = document.getElementById('showRegister');
            const showLogin = document.getElementById('showLogin');
            
            if (showRegister) {
                showRegister.addEventListener('click', (e) => {
                    e.preventDefault();
                    switchAuthTab('register');
                });
            }
            
            if (showLogin) {
                showLogin.addEventListener('click', (e) => {
                    e.preventDefault();
                    switchAuthTab('login');
                });
            }
        }

        function setupMiningEventListeners() {
            // Start mining button
            const startMiningBtn = document.getElementById('startMiningBtn');
            if (startMiningBtn) {
                startMiningBtn.addEventListener('click', async () => {
                    await handleStartMining();
                });
            }

            // Stop mining button
            const stopMiningBtn = document.getElementById('stopMiningBtn');
            if (stopMiningBtn) {
                stopMiningBtn.addEventListener('click', async () => {
                    await handleStopMining();
                });
            }

            // Logout button
            const logoutBtn = document.getElementById('logoutBtn');
            if (logoutBtn) {
                logoutBtn.addEventListener('click', () => {
                    handleLogout();
                });
            }

            // Algorithm selection
            const algorithmCards = document.querySelectorAll('.algorithm-card');
            algorithmCards.forEach(card => {
                card.addEventListener('click', () => {
                    // Remove active class from all cards
                    algorithmCards.forEach(c => c.classList.remove('active'));
                    // Add active class to clicked card
                    card.classList.add('active');
                    
                    const algorithm = card.getAttribute('data-algorithm');
                    console.log('Selected algorithm:', algorithm);
                });
            });

            // Leaderboard tabs
            const leaderboardTabs = document.querySelectorAll('.tab-btn');
            leaderboardTabs.forEach(tab => {
                tab.addEventListener('click', () => {
                    // Remove active class from all tabs
                    leaderboardTabs.forEach(t => t.classList.remove('active'));
                    // Add active class to clicked tab
                    tab.classList.add('active');
                    
                    const period = tab.getAttribute('data-period');
                    console.log('Selected period:', period);
                });
            });
        }

        async function handleLogin() {
            const email = document.getElementById('loginEmail').value;
            const password = document.getElementById('loginPassword').value;
            
            if (!email || !password) {
                showNotification('Por favor ingresa tu email y contraseña', 'error');
                return;
            }

            try {
                const userData = await window.supabaseIntegration.loginUser(email, password);
                showNotification('Sesión iniciada correctamente', 'success');
                showMiningDashboard();
                
                // Verificar si hay una sesión de minería activa después del login
                setTimeout(async () => {
                    await checkAndRestoreMiningSession();
                }, 500);
            } catch (error) {
                showNotification('Error iniciando sesión: ' + error.message, 'error');
            }
        }

        async function handleRegister() {
            const email = document.getElementById('registerEmail').value;
            const username = document.getElementById('registerUsername').value;
            const password = document.getElementById('registerPassword').value;
            const referralCode = document.getElementById('referralCode').value;

            if (!email || !username || !password) {
                showNotification('Por favor completa todos los campos requeridos (email, usuario y contraseña)', 'error');
                return;
            }

            if (password.length < 6) {
                showNotification('La contraseña debe tener al menos 6 caracteres', 'error');
                return;
            }

            try {
                const result = await window.supabaseIntegration.registerUser(email, username, password, referralCode || null);
                showNotification('Usuario registrado correctamente', 'success');
                showMiningDashboard();
                
                // Verificar si hay una sesión de minería activa después del registro
                setTimeout(async () => {
                    await checkAndRestoreMiningSession();
                }, 500);
            } catch (error) {
                showNotification('Error registrando usuario: ' + error.message, 'error');
            }
        }

        async function handleStartMining() {
            try {
                // Limpiar completamente cualquier sesión existente antes de intentar iniciar
                console.log('🧹 Limpiando sesiones existentes...');
                localStorage.removeItem('rsc_mining_session');
                
                // Resetear el estado de minería en supabaseIntegration
                if (window.supabaseIntegration) {
                    window.supabaseIntegration.miningSession.isActive = false;
                    window.supabaseIntegration.miningSession.sessionId = null;
                    window.supabaseIntegration.miningSession.startTime = null;
                    window.supabaseIntegration.miningSession.endTime = null;
                    window.supabaseIntegration.miningSession.tokensMined = 0;
                }
                
                // Esperar un momento para que se procese la limpieza
                await new Promise(resolve => setTimeout(resolve, 200));
                
                await window.supabaseIntegration.startMiningSession();
                showNotification('⛏️ Minería de 24 horas iniciada - No se detendrá hasta completarse', 'success');
                
                // Actualizar UI
                document.getElementById('startMiningBtn').style.display = 'none';
                document.getElementById('stopMiningBtn').classList.add('hidden'); // Ocultar botón de detener
                
                // Mostrar información de la sesión
                const session = window.supabaseIntegration.getMiningSession();
                const endTime = new Date(session.endTime);
                showNotification(`⏰ La minería terminará el: ${endTime.toLocaleString()}`, 'info');
                
                // Iniciar simulación de minería
                startMiningSimulation();
            } catch (error) {
                console.error('❌ Error en handleStartMining:', error);
                showNotification('Error iniciando minería: ' + error.message, 'error');
            }
        }

        async function handleStopMining() {
            showNotification('❌ No puedes detener la minería - Dura 24 horas completas', 'error');
        }

        function handleLogout() {
            window.supabaseIntegration.logout();
            showNotification('Sesión cerrada', 'info');
            showAuthSection();
        }

        function switchAuthTab(tab) {
            const loginForm = document.getElementById('loginForm');
            const registerForm = document.getElementById('registerForm');
            
            if (tab === 'register') {
                loginForm.classList.remove('active');
                registerForm.classList.add('active');
            } else {
                registerForm.classList.remove('active');
                loginForm.classList.add('active');
            }
        }

        function showAuthSection() {
            document.getElementById('authSection').style.display = 'block';
            document.getElementById('miningDashboard').style.display = 'none';
        }

        function showMiningDashboard() {
            document.getElementById('authSection').style.display = 'none';
            document.getElementById('miningDashboard').style.display = 'block';
            
            // Actualizar información del usuario
            const user = window.supabaseIntegration.getCurrentUser();
            if (user) {
                document.getElementById('userName').textContent = user.username;
                
                // Usar la función centralizada para actualizar el balance
                updateBalanceDisplay();
                
                // Mostrar información del usuario en el header
                document.getElementById('userInfo').style.display = 'flex';
                
                // Mostrar botón de logout
                document.getElementById('logoutBtn').style.display = 'block';
                
                // Actualizar estado de conexión
                document.getElementById('connectionText').textContent = 'Connected';
                document.getElementById('connectionStatus').classList.add('connected');
            }
        }

        let miningInterval = null;

        function startMiningSimulation() {
            console.log('⛏️ Iniciando simulación de minería...');
            
            // Detener cualquier simulación anterior
            stopMiningSimulation();
            
            // Verificar que hay una sesión activa
            const session = window.supabaseIntegration.getMiningSession();
            if (!session.isActive) {
                console.log('❌ No hay sesión activa para simular');
                return;
            }
            
            console.log(`✅ Simulación iniciada - Sesión: ${session.sessionId}`);
            console.log(`⏰ Tiempo restante: ${window.supabaseIntegration.getRemainingTime()} horas`);
            
            // Actualizar progreso cada segundo
            const progressInterval = setInterval(() => {
                updateMiningProgress();
                
                // Verificar si la sesión expiró
                if (window.supabaseIntegration.isSessionExpired()) {
                    console.log('⏰ Sesión de 24 horas completada automáticamente');
                    showNotification('🎉 ¡Sesión de 24 horas completada! Puedes iniciar una nueva sesión', 'success');
                    stopMiningSimulation();
                    resetMiningUI();
                    return;
                }
            }, 1000);
            
            // Simular minería cada 5 segundos
            miningInterval = setInterval(() => {
                // Verificar si la sesión sigue activa
                const currentSession = window.supabaseIntegration.getMiningSession();
                if (!currentSession.isActive) {
                    console.log('⏹️ Sesión de minería detenida');
                    stopMiningSimulation();
                    return;
                }
                
                // Simular minería
                const tokensMined = Math.random() * 0.009 + 0.001;
                const hashRate = Math.random() * 900 + 100;
                const efficiency = Math.random() * 20 + 80;
                
                // Actualizar stats en Supabase (incluye balance automáticamente)
                window.supabaseIntegration.updateMiningStats(tokensMined, hashRate, efficiency);
                
                // Actualizar UI
                updateMiningUI(tokensMined, hashRate, efficiency);
            }, 5000);
            
            // Guardar referencia al intervalo de progreso para poder detenerlo
            window.miningProgressInterval = progressInterval;
        }

        function stopMiningSimulation() {
            console.log('⏹️ Deteniendo simulación de minería...');
            
            if (miningInterval) {
                clearInterval(miningInterval);
                miningInterval = null;
                console.log('✅ Intervalo de minería detenido');
            }
            
            if (window.miningProgressInterval) {
                clearInterval(window.miningProgressInterval);
                window.miningProgressInterval = null;
                console.log('✅ Intervalo de progreso detenido');
            }
            
            console.log('✅ Simulación de minería detenida completamente');
        }


        function showSessionStatus() {
            const session = window.supabaseIntegration.getMiningSession();
            if (session.isActive) {
                const startTime = new Date(session.startTime);
                const endTime = new Date(session.endTime);
                const now = new Date();
                const elapsed = now - startTime;
                const remaining = endTime - now;
                
                const hours = Math.floor(elapsed / 3600000);
                const minutes = Math.floor((elapsed % 3600000) / 60000);
                const seconds = Math.floor((elapsed % 60000) / 1000);
                
                const remainingHours = Math.floor(remaining / 3600000);
                const remainingMinutes = Math.floor((remaining % 3600000) / 60000);
                
                console.log(`📊 Estado de la sesión:`);
                console.log(`⏰ Tiempo transcurrido: ${hours}h ${minutes}m ${seconds}s`);
                console.log(`⏳ Tiempo restante: ${remainingHours}h ${remainingMinutes}m`);
                console.log(`💰 Tokens minados: ${session.tokensMined.toFixed(6)} RSC`);
                console.log(`🔋 Hash Rate: ${session.hashRate.toFixed(2)} H/s`);
                console.log(`⚡ Eficiencia: ${session.efficiency.toFixed(1)}%`);
            }
        }

        function checkExpiredSession() {
            try {
                const stored = localStorage.getItem('rsc_mining_session');
                if (stored) {
                    const sessionData = JSON.parse(stored);
                    const now = new Date();
                    const startTime = new Date(sessionData.startTime);
                    const elapsed = now - startTime;
                    const duration = 24 * 60 * 60 * 1000; // 24 horas
                    
                    if (elapsed >= duration) {
                        console.log('⏰ Sesión expirada detectada - Procesando recompensas...');
                        
                        // Procesar recompensas de la sesión expirada
                        const tokensMined = sessionData.tokensMined || 0;
                        if (tokensMined > 0) {
                            const user = window.supabaseIntegration.getCurrentUser();
                            if (user) {
                                user.balance += tokensMined;
                                window.supabaseIntegration.saveUserToStorage();
                                
                                // Actualizar UI
                                const userBalance = document.getElementById('userBalance');
                                const userBalanceDisplay = document.getElementById('userBalanceDisplay');
                                
                                if (userBalance) {
                                    userBalance.textContent = user.balance.toFixed(6) + ' RSC';
                                }
                                if (userBalanceDisplay) {
                                    userBalanceDisplay.textContent = user.balance.toFixed(6) + ' RSC';
                                }
                                
                                showNotification(`🎉 ¡Sesión de 24 horas completada! +${tokensMined.toFixed(6)} RSC agregados`, 'success');
                            }
                        }
                        
                        // Limpiar sesión expirada
                        localStorage.removeItem('rsc_mining_session');
                        console.log('✅ Sesión expirada procesada y limpiada');
                    }
                }
            } catch (error) {
                console.error('❌ Error procesando sesión expirada:', error);
            }
        }

        function resetMiningUI() {
            // Mostrar botón de inicio
            document.getElementById('startMiningBtn').style.display = 'block';
            document.getElementById('stopMiningBtn').classList.add('hidden');
            
            // Resetear métricas
            const hashRateDisplay = document.getElementById('hashRateDisplay');
            if (hashRateDisplay) {
                hashRateDisplay.textContent = '0 H/s';
            }
            
            const efficiencyDisplay = document.getElementById('efficiencyDisplay');
            if (efficiencyDisplay) {
                efficiencyDisplay.textContent = '100%';
            }
            
            const tokensPerSecondDisplay = document.getElementById('tokensPerSecondDisplay');
            if (tokensPerSecondDisplay) {
                tokensPerSecondDisplay.textContent = '0.000000 RSC/s';
            }
            
            // Resetear progreso
            const sessionTimeDisplay = document.getElementById('sessionTimeDisplay');
            if (sessionTimeDisplay) {
                sessionTimeDisplay.textContent = '00:00:00';
            }
            
            const sessionTokensDisplay = document.getElementById('sessionTokensDisplay');
            if (sessionTokensDisplay) {
                sessionTokensDisplay.textContent = '0.000000 RSC';
            }
            
            const totalHashesDisplay = document.getElementById('totalHashesDisplay');
            if (totalHashesDisplay) {
                totalHashesDisplay.textContent = '0';
            }
            
            const progressPercentageDisplay = document.getElementById('progressPercentage');
            if (progressPercentageDisplay) {
                progressPercentageDisplay.textContent = '0%';
            }
            
            const progressBarFill = document.getElementById('progressBarFill');
            if (progressBarFill) {
                progressBarFill.style.width = '0%';
            }
        }


        function updateMiningUI(tokensMined, hashRate, efficiency) {
            // Actualizar métricas en tiempo real
            const hashRateDisplay = document.getElementById('hashRateDisplay');
            if (hashRateDisplay) {
                hashRateDisplay.textContent = Math.round(hashRate) + ' H/s';
            }
            
            const efficiencyDisplay = document.getElementById('efficiencyDisplay');
            if (efficiencyDisplay) {
                efficiencyDisplay.textContent = Math.round(efficiency) + '%';
            }
            
            const tokensPerSecondDisplay = document.getElementById('tokensPerSecondDisplay');
            if (tokensPerSecondDisplay) {
                tokensPerSecondDisplay.textContent = tokensMined.toFixed(6) + ' RSC/s';
            }
            
            // Actualizar balance del usuario en la interfaz
            updateBalanceDisplay();
            
            // Actualizar progreso de minería
            updateMiningProgress();
        }

        // Función de emergencia para limpiar sesiones (disponible en consola)
        window.forceCleanMiningSessions = function() {
            console.log('🧹 FORZANDO limpieza completa de sesiones...');
            localStorage.removeItem('rsc_mining_session');
            localStorage.removeItem('rsc_user_data');
            
            if (window.supabaseIntegration) {
                window.supabaseIntegration.miningSession.isActive = false;
                window.supabaseIntegration.miningSession.sessionId = null;
                window.supabaseIntegration.miningSession.startTime = null;
                window.supabaseIntegration.miningSession.endTime = null;
                window.supabaseIntegration.miningSession.tokensMined = 0;
            }
            
            console.log('✅ Limpieza completa realizada');
            showNotification('🧹 Sesiones limpiadas completamente', 'success');
        };

        function updateMiningProgress() {
            const session = window.supabaseIntegration.getMiningSession();
            if (!session.isActive) return;
            
            // Calcular tiempo transcurrido
            const now = new Date();
            const startTime = new Date(session.startTime);
            const elapsed = now - startTime;
            const hours = Math.floor(elapsed / 3600000);
            const minutes = Math.floor((elapsed % 3600000) / 60000);
            const seconds = Math.floor((elapsed % 60000) / 1000);
            
            // Actualizar tiempo de sesión
            const sessionTimeDisplay = document.getElementById('sessionTimeDisplay');
            if (sessionTimeDisplay) {
                sessionTimeDisplay.textContent = 
                    `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
            }
            
            // Actualizar tokens minados en la sesión
            const sessionTokensDisplay = document.getElementById('sessionTokensDisplay');
            if (sessionTokensDisplay) {
                sessionTokensDisplay.textContent = session.tokensMined.toFixed(6) + ' RSC';
            }
            
            // Calcular hashes totales (aproximado)
            const totalHashes = Math.floor(session.hashRate * elapsed / 1000);
            const totalHashesDisplay = document.getElementById('totalHashesDisplay');
            if (totalHashesDisplay) {
                totalHashesDisplay.textContent = totalHashes.toLocaleString();
            }
            
            // Calcular porcentaje de progreso (basado en 24 horas)
            const progressPercentage = Math.min(100, (elapsed / (24 * 60 * 60 * 1000)) * 100);
            const progressPercentageDisplay = document.getElementById('progressPercentage');
            if (progressPercentageDisplay) {
                progressPercentageDisplay.textContent = Math.round(progressPercentage) + '%';
            }
            
            // Actualizar barra de progreso
            const progressBarFill = document.getElementById('progressBarFill');
            if (progressBarFill) {
                progressBarFill.style.width = Math.round(progressPercentage) + '%';
            }
            
            // Actualizar total minado (balance total del usuario)
            const totalMinedDisplay = document.getElementById('totalMinedDisplay');
            if (totalMinedDisplay) {
                const user = window.supabaseIntegration.getCurrentUser();
                if (user) {
                    totalMinedDisplay.textContent = user.balance.toFixed(6) + ' RSC';
                    console.log(`📊 Total Mined actualizado: ${user.balance.toFixed(6)} RSC`);
                }
            }
            
            // Mostrar tiempo restante en el título de la página
            const remainingHours = window.supabaseIntegration.getRemainingTime();
            if (remainingHours > 0) {
                document.title = `RSC Mining Platform - ${remainingHours}h restantes`;
            }
        }

        function showNotification(message, type = 'info') {
            console.log(`[${type.toUpperCase()}] ${message}`);
            
            // Crear notificación visual si es necesario
            const notification = document.createElement('div');
            notification.className = `notification notification-${type}`;
            notification.textContent = message;
            
            const container = document.getElementById('notificationsContainer');
            if (container) {
                container.appendChild(notification);
                
                setTimeout(() => {
                    notification.remove();
                }, 3000);
            }
        }
    </script>
</body>
</html>
